  version: 2.1

  orbs:
    python: circleci/python@0.3.2

  jobs:

    build-and-test:
      executor: python/default
      steps:
        - checkout
        - python/load-cache
        - run:
            name: Install Dependencies
            command: python3 -m pip install --use-deprecated=legacy-resolver -r requirements.txt
        - python/save-cache
        - run:
            name: Running tests
            command: python3 -m unittest discover -v
        - store_test_results:
            path: results.xml

  lint-and-coverage:
    executor: python/default
    steps:
      - checkout
      - python/load-cache
      - python/install-deps
      - python/save-cache
      - run:
          name: Coverage
          command: |
            coverage run
            coverage report

  workflows:
    main:
      jobs:
        - build-and-test
